# Hiker RT5350 固件版本说明

## 版本概览

Hiker 固件基于 OpenWrt 25.03，针对 RT5350 (360MHz, 32MB RAM) 优化。

提供 **4 个版本**，采用增量添加策略：

```
v0.1 (基础)
  ↓ + P910ND + USB
v0.2 (打印服务器) ⭐推荐
  ↓ + WiFi 客户端
v0.3 (打印+WiFi客户端) ⚠️性能差
  ↓ + WiFi AP
v0.4 (完整WiFi) ⚠️性能差
```

## 功能对比表

| 功能特性 | v0.1 基础 | v0.2 打印 | v0.3 WiFi | v0.4 完整 |
|---------|----------|----------|----------|----------|
| **基础系统** | | | | |
| LuCI 中文界面 | ✅ | ✅ | ✅ | ✅ |
| SSH (Dropbear) | ✅ | ✅ | ✅ | ✅ |
| LED 控制（红+蓝） | ✅ | ✅ | ✅ | ✅ |
| DHCP 客户端 | ✅ | ✅ | ✅ | ✅ |
| apk 包管理器 | ✅ | ✅ | ✅ | ✅ |
| **打印功能** | | | | |
| USB 驱动 | ❌ | ✅ | ✅ | ✅ |
| P910ND 服务器 | ❌ | ✅ | ✅ | ✅ |
| LuCI P910ND 界面 | ❌ | ✅ | ✅ | ✅ |
| **网络功能** | | | | |
| WiFi 客户端 | ❌ | ❌ | ✅ | ✅ |
| WLAN LED | ❌ | ❌ | ✅ | ✅ |
| WiFi AP | ❌ | ❌ | ❌ | ✅ |
| 防火墙 | ❌ | ❌ | ❌ | ❌ |
| DHCP/DNS 服务器 | ❌ | ❌ | ❌ | ❌ |

## 性能对比表

| 指标 | v0.1 | v0.2 ⭐ | v0.3 ⚠️ | v0.4 ⚠️ |
|------|------|---------|---------|---------|
| **软件包数** | 15 | 22 | 37 | 32 |
| **固件大小** | ~3.5 MB | ~4.0 MB | ~5.0 MB | ~5.2 MB |
| **CPU idle** | 98% | 98% | 0% | 0% |
| **CPU sys** | 1% | 1% | 90-97% | 90-97% |
| **内存占用** | ~14 MB | ~22 MB | ~24 MB | ~24 MB |
| **启动时间** | 快 | 快 | 慢 | 慢 |
| **系统负载** | <1.0 | <1.0 | >5.0 | >5.0 |
| **响应速度** | 流畅 ✅ | 流畅 ✅ | 卡顿 ❌ | 卡顿 ❌ |
| **推荐度** | ⭐⭐ | ⭐⭐⭐ | ❌ | ❌ |

---

## v0.1 - 基础版

**最轻量的 LuCI 中文固件**

### 包含功能
- ✅ LuCI Web 界面（中文）
- ✅ Bootstrap 主题
- ✅ SSH (Dropbear)
- ✅ LED 控制（红色 + 蓝色）
- ✅ DHCP 客户端
- ✅ apk 包管理器（可运行时安装软件）
- ✅ 基础系统（busybox, netifd, procd, uci）

### 移除功能
- ❌ WiFi
- ❌ USB
- ❌ P910ND
- ❌ 防火墙
- ❌ DHCP/DNS 服务器
- ❌ opkg, mtd, swconfig, fwtool, logd, urngd

### 性能指标
- **固件大小**: ~3.5 MB
- **CPU idle**: 98%
- **内存占用**: ~14 MB
- **软件包数**: 15 个
- **启动时间**: 快速

### 性能测试结果
```
CPU:   0% usr   1% sys   0% nic  98% idle
Load average: 0.71 0.42 0.17  (OpenWrt 25.03)
Mem: 14400K used, 17800K free
```

### 适用场景
- 基础路由/网关
- 纯管理设备
- 追求最小体积

### 配置文件
```bash
hiker-v0.1.config
```

---

## v0.2 - 打印服务器版 ⭐推荐

**v0.1 + P910ND + USB 打印机**

### 包含功能
- ✅ **v0.1 所有功能**
- ✅ **P910ND 打印服务器** + LuCI 管理界面（中文）
- ✅ **USB 打印机驱动**（USB 2.0 + USB 1.1）
- ✅ USB 核心驱动（OHCI + EHCI）

### 新增软件包（相比 v0.1）
- `kmod-usb-core` - USB 核心
- `kmod-usb-ohci` - USB 1.1
- `kmod-usb2` - USB 2.0
- `kmod-usb-printer` - USB 打印机
- `p910nd` - 打印服务器
- `luci-app-p910nd` - LuCI 界面
- `luci-i18n-p910nd-zh-cn` - 中文语言包

### 性能指标
- **固件大小**: ~4.0 MB
- **CPU idle**: 98% ✅
- **内存占用**: ~22 MB
- **软件包数**: 22 个
- **启动时间**: 快速（~30-40秒）

### 性能测试结果
```
CPU:   0% usr   1% sys   0% nic  98% idle
Load average: 0.74
Mem: 22440K used, 3940K free, 5512K cached
```

### 适用场景
- ⭐ **网络打印服务器**（主要用途）
- ⭐ 有线连接路由器
- ⭐ USB 打印机共享
- ⭐ 需要 Web 界面管理

### 配置文件
```bash
hiker-v0.2.config
```

---

## v0.3 - WiFi 客户端版 ⚠️

**v0.1 + WiFi 客户端（不推荐）**

### 包含功能
- ✅ **v0.1 所有功能**
- ✅ **WiFi 客户端**（wpa_supplicant）
- ✅ **WLAN LED 支持**
- ✅ WiFi 驱动（rt2800-soc）
- ✅ 无线工具（iw, iwinfo）

### 新增软件包（相比 v0.1）
- `kmod-mac80211` - WiFi 协议栈
- `kmod-rt2800-lib` - RT2800 驱动库
- `kmod-rt2800-mmio` - MMIO 支持
- `kmod-rt2800-soc` - RT5350 专用驱动
- `kmod-rt2x00-lib` - RT2x00 通用库
- `kmod-rt2x00-mmio` - MMIO 通用
- `wpa-supplicant-mbedtls` - WiFi 客户端
- `iw` - WiFi 配置工具
- `iwinfo` - WiFi 信息工具

### 性能指标
- **固件大小**: ~4.8 MB
- **CPU idle**: 0% ❌
- **CPU sys**: 90-97% ⚠️
- **内存占用**: ~24 MB
- **软件包数**: 30 个
- **启动时间**: 慢（~60-90秒）

### 性能测试结果 ⚠️
```
CPU:  10% usr  89% sys   0% nic   0% idle
Load average: 6.48 5.03 3.37
Mem: 24704K used, 1676K free
```

### 已知问题
- ❌ **WiFi 驱动占用 100% CPU**
- ❌ 系统严重卡顿
- ❌ SSH 响应慢或超时
- ❌ Web 界面几乎无法使用
- ❌ 启动时间长

### 问题原因
可能是 OpenWrt 6.12 内核的 rt2800 驱动性能回归问题。

### 适用场景
- ⚠️ **不推荐日常使用**
- 仅供实验/测试
- 建议使用 v0.2 + 外置路由器 WiFi

### 配置文件
```bash
hiker-v0.3.config
```

---

## v0.4 - 完整版 ⚠️

**v0.2 + WiFi = v0.1 + P910ND + WiFi（不推荐）**

### 包含功能
- ✅ **v0.1 所有功能**
- ✅ **v0.2 的 P910ND 打印服务器**
- ✅ **v0.3 的 WiFi 客户端**
- ✅ 最完整的功能组合

### 性能指标
- **固件大小**: ~5.0 MB
- **CPU idle**: 0% ❌
- **CPU sys**: 90-97% ⚠️
- **内存占用**: ~24 MB
- **软件包数**: 37 个
- **启动时间**: 慢

### 性能测试结果 ⚠️
```
CPU:   2% usr  97% sys   0% nic   0% idle
Load average: 5.82 6.78 4.60
Mem: 22864K used, 3516K free
```

### 已知问题
与 v0.3 相同的 WiFi 驱动性能问题。

### 适用场景
- ❌ **不推荐日常使用**
- 仅供测试完整功能
- RT5350 硬件无法胜任

### 配置文件
```bash
hiker-v0.4.config
```

---

## 版本选择建议

### 🎯 推荐流程

1. **大多数用户**: 使用 **v0.2** ⭐
   - 完整的打印服务器功能
   - 性能完美（CPU 98% idle）
   - 稳定可靠

2. **追求极致精简**: 使用 **v0.1**
   - 最小固件体积
   - 可通过 apk 按需安装软件

3. **需要 WiFi**: ⚠️ **不推荐**
   - RT5350 + WiFi = 性能灾难
   - 建议：使用 v0.2 + 外置路由器提供 WiFi

### 📊 性能对比总结

| 场景 | 推荐版本 | 原因 |
|------|----------|------|
| 网络打印 | v0.2 ⭐⭐⭐ | 性能完美 + 功能完整 |
| 基础管理 | v0.1 ⭐⭐ | 最小体积 |
| 需要 WiFi | v0.3/v0.4 ❌ | CPU 100% 占用，不可用 |

---

## 编译说明

### 快速编译（推荐）
```bash
# 1. 选择版本配置
cp hiker-v0.2.config hiker.config

# 2. 清理缓存（配置变化时必须）
./fast-hiker.sh --clean

# 3. 快速编译
./fast-hiker.sh
```

### 完整编译
```bash
# 1. 选择版本配置
cp hiker-v0.1.config hiker.config

# 2. 清理缓存
./local-hiker.sh --clean

# 3. 完整编译
./local-hiker.sh
```

### 编译时间
- 快速编译：5-10 分钟（使用预编译工具链）
- 完整编译：30-60 分钟（首次或完全清理后）

---

## 升级说明

### 从 OpenWrt 15.05 升级
```bash
./flash-hiker.sh <设备IP> releases/hiker-25.300_v0.2.bin
# 使用 -F 强制升级（设备标识变化）
```

### 在版本间升级
```bash
# v0.1 ↔ v0.2 ↔ v0.3 ↔ v0.4
./flash-hiker.sh <设备IP> releases/hiker-25.300_v0.x.bin
# 不需要 -F，直接升级
```

---

## RT5350 硬件结论

### ✅ 适合
- 有线网络设备
- 打印服务器
- 轻量路由/网关

### ❌ 不适合
- WiFi 功能（驱动性能问题）
- 高负载应用
- 多功能并发（WiFi + 其他服务）

### 💡 最佳用途
**有线网络 USB 打印服务器** - 使用 **v0.2** 版本

---

## 相关文件

- `hiker-v0.1.config` - v0.1 基础版配置
- `hiker-v0.2.config` - v0.2 打印服务器配置 ⭐
- `hiker-v0.3.config` - v0.3 WiFi 客户端配置
- `hiker-v0.4.config` - v0.4 完整版配置
- `hiker.config` - 当前编译使用的配置（默认 v0.2）
- `RELEASES.md` - 详细发布历史
- `README.md` - 项目总览

---

最后更新：2025-10-31

