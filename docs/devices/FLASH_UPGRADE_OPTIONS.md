# Flash 升级方案

## 当前配置
```
芯片：GigaDevice GD25Q64
容量：8 MB (64 Mbit)
封装：SOP-8 / WSON-8
接口：SPI
频率：15 MHz（DTS 中设置 10 MHz）
```

---

## 📦 推荐升级方案

### 1. GigaDevice GD25Q128 (16 MB) ⭐ 推荐
```
容量：16 MB (128 Mbit)
封装：SOP-8（与 GD25Q64 兼容）
价格：约 ¥3-5
优势：
  ✓ 同厂家，兼容性最好
  ✓ 直接替换，无需修改代码
  ✓ 容量翻倍
DTS 配置：
  compatible = "jedec,spi-nor";  // 通用配置即可
```

### 2. Winbond W25Q128 (16 MB) ⭐ 推荐
```
容量：16 MB (128 Mbit)
封装：SOP-8
价格：约 ¥3-5
优势：
  ✓ 市场占有率高，质量稳定
  ✓ OpenWrt 广泛支持
  ✓ 兼容性好
DTS 配置：
  compatible = "jedec,spi-nor";
  或 compatible = "winbond,w25q128";
```

### 3. Macronix MX25L12805D (16 MB)
```
容量：16 MB (128 Mbit)
封装：SOP-8
价格：约 ¥4-6
优势：
  ✓ 工业级品质
  ✓ 温度范围宽
DTS 配置：
  compatible = "jedec,spi-nor";
  或 compatible = "macronix,mx25l12805d";
```

### 4. GigaDevice GD25Q256 (32 MB) - 如果需要更大
```
容量：32 MB (256 Mbit)
封装：SOP-8 / SOP-16
价格：约 ¥8-12
注意：
  ⚠️  需要 4 字节地址模式
  ⚠️  可能需要修改 U-Boot
  ⚠️  不是所有 RT5350 U-Boot 都支持
```

---

## 🔧 升级步骤

### 硬件准备
1. **工具**：
   - 热风枪或烙铁（拆卸旧芯片）
   - 焊锡、助焊剂
   - 放大镜或显微镜
   - 编程器（CH341A 或类似，用于预烧录）

2. **芯片识别**：
   - 确认封装：SOP-8（8 脚贴片）
   - 确认引脚兼容（1 脚标记）
   - 建议购买与原厂相同品牌

### 软件准备

#### 方案 A：直接替换（推荐）
```bash
# 1. 备份原 Flash（重要！）
# 通过 Breed 或编程器备份整个 8MB Flash

# 2. 准备新 Flash
# 使用编程器烧录：
#   - U-Boot (Breed) 到 0x0-0x30000
#   - Factory (EEPROM) 到 0x40000-0x50000

# 3. 焊接新芯片

# 4. 刷入固件
# 通过 Breed 刷入 16MB 固件
```

#### 方案 B：修改 DTS 分区表（最大化利用空间）
```dts
// 16 MB Flash 优化分区布局
partition@0 {
    label = "u-boot";
    reg = <0x0 0x30000>;      // 192 KB
    read-only;
};

partition@30000 {
    label = "u-boot-env";
    reg = <0x30000 0x10000>;  // 64 KB
    read-only;
};

partition@40000 {
    label = "factory";
    reg = <0x40000 0x10000>;  // 64 KB
    read-only;
};

partition@50000 {
    label = "firmware";
    reg = <0x50000 0xFB0000>; // 15872 KB (16 MB - 320 KB)
    compatible = "denx,uimage";
};

// 总容量：16 MB (0x1000000)
// firmware 可用空间：15.5 MB！
```

---

## 💰 成本分析

| 芯片型号 | 容量 | 价格 | 固件空间 | 推荐度 |
|---------|------|------|----------|--------|
| GD25Q64 (原装) | 8 MB | ¥2 | 7.5 MB | - 当前 |
| **GD25Q128** | 16 MB | ¥3-5 | **15.5 MB** | ⭐⭐⭐⭐⭐ |
| **W25Q128** | 16 MB | ¥3-5 | **15.5 MB** | ⭐⭐⭐⭐⭐ |
| MX25L12805D | 16 MB | ¥4-6 | 15.5 MB | ⭐⭐⭐⭐ |
| GD25Q256 | 32 MB | ¥8-12 | 31.5 MB | ⭐⭐⭐ |

---

## ⚠️ 注意事项

### 1. Breed U-Boot 支持
- Breed 通常自动识别 Flash 大小
- 但需要确认你的 Breed 版本支持 16 MB+
- 建议升级到最新 Breed（如果可能）

### 2. 备份关键数据
升级前**必须备份**：
```bash
# 在 Breed 中：
- 备份 EEPROM (factory 分区)
- 备份完整 Flash

# 关键数据：
- MAC 地址 (factory 0x4)
- WiFi 校准数据 (factory 0x0-0x200)
- 序列号 (factory 0x110)
```

### 3. 焊接技巧
- SOP-8 芯片较小，需要一定焊接经验
- 或者找专业维修店代焊（约 ¥20-50）
- 注意防静电

### 4. 测试流程
```
1. 焊接新芯片
2. 进入 Breed（按住 reset 上电）
3. 检查 Flash 识别（应显示 16 MB）
4. 恢复 factory 分区（EEPROM）
5. 刷入新固件
6. 测试网络、WiFi、USB
```

---

## 🎯 推荐方案：GD25Q128 (16 MB)

**理由**：
1. ✓ 同厂家，兼容性 100%
2. ✓ 价格便宜（¥3-5）
3. ✓ 容量翻倍（8MB → 16MB）
4. ✓ 无需修改硬件电路
5. ✓ Breed 自动识别

**升级后的优势**：
- 固件空间：7.5 MB → 15.5 MB
- 可以安装完整 LuCI + 大量软件包
- overlay 空间充足（8 MB+）
- 永不担心空间不足

**购买建议**：
- 淘宝/闲鱼搜索：GD25Q128CSIG（SOP-8 封装）
- 或：W25Q128JVSIQ（推荐原装）
- 价格：¥3-5/片
- 建议购买 2-3 片备用

---

## 📝 是否值得升级？

| 场景 | 8 MB | 16 MB | 建议 |
|------|------|-------|------|
| 仅 SSH 管理 | ✓ 够用 | 过剩 | 不升级 |
| 基础路由器（无 LuCI） | ✓ 勉强 | 宽裕 | 可选 |
| 完整 LuCI + 插件 | ✗ 太小 | ✓ 够用 | **推荐升级** |
| 打印服务器 + LuCI | ✗ 太小 | ✓ 够用 | **推荐升级** |
| 多功能路由器 | ✗ 不可能 | ✓ 勉强 | **必须升级** |

**结论**：
- 如果只是测试/学习：**不升级**，用纯 SSH 版本
- 如果长期使用需要 LuCI：**升级到 16 MB**
- 成本很低（¥3-5），焊接有风险但值得
